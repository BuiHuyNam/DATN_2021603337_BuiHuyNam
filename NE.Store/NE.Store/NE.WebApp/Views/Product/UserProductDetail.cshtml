@model NE.Application.Dtos.ProductDto.ProductViewDto
@{
    Layout = "~/Views/Shared/_LayoutSub.cshtml"; 
    ViewData["Title"] = "Chi tiết sản phẩm";
}
<style>
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type=number] {
        -moz-appearance: textfield;
        text-align: center;
    }

    .custom-hover-green {
        color: #7fad39;
        border-color: #7fad39;
        transition: all 0.3s ease-in-out;
    }

        .custom-hover-green:hover {
            background-color: #7fad39;
            color: white;
        }

   
    /* cho mọi .color-images chỉ tồn tại về mặt DOM,
         chứ không chiếm khối nào trong flex layout */
    .color-images {
        display: contents;
    }

    .bg-custom {
        background-color: #7fad39 !important;
    }

    .text-custom {
        color: #7fad39 !important;
    }


</style>

<div class="container py-5">
    <div class="row shadow-lg rounded-3 bg-white p-4">
        <!-- LEFT: Hình ảnh sản phẩm -->
        <div class="col-md-6">
            <div class="border rounded p-3 text-center">
                <img id="mainImage" src="https://localhost:7099/api/ImageFile/Download?id=@Model.ProductColors.First().ImageFiles.First().Id" class="img-fluid mb-3" style="max-height: 300px;" alt="Ảnh chính">
            </div>

            <!-- Danh sách ảnh phụ -->
            <div class="mt-3 d-flex flex-wrap gap-2" id="productColorImages">
                @foreach (var color in Model.ProductColors)
                {
                    <!-- span là inline, không tạo khối mới -->
                    <span class="color-images" data-color-id="@color.ColorId">
                        @foreach (var image in color.ImageFiles)
                        {
                            <img src="https://localhost:7099/api/ImageFile/Download?id=@image.Id"
                                 class="img-thumbnail"
                                 style="width: 80px; height: 80px; object-fit: cover;"
                                 alt="Ảnh phụ @image.Id"
                                 data-image-id="@image.Id"
                                 data-color-id="@color.ColorId">
                        }
                    </span>
                }
            </div>

        </div>

        <!-- RIGHT: Thông tin sản phẩm -->
        <div class="col-md-6">
            <h2>@Model.ProductName</h2>

            <!-- Đánh giá -->
            <div class="mb-2">
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star-half-alt text-warning"></i>
                <i class="far fa-star text-muted"></i>
                <span class="ms-2">(25 đánh giá)</span>
            </div>

            <!-- Giá -->
            <div class="bg-light p-3 rounded w-100">
                @if (Model.Discount > 0)
                {
                    var discountedPrice = Model.Price * (1 - Model.Discount / 100);
                    <span class="text-muted" style="text-decoration: line-through;">
                        @Model.Price.ToString("N0") ₫
                    </span>
                    <span class="text-danger fs-2 fw-bold me-2">
                        @discountedPrice.ToString("N0") ₫
                    </span>
                    <span class="badge bg-danger text-uppercase fw-semibold">
                        @Model.Discount.ToString("0")% Giảm
                    </span>
                }
                else
                {
                    <span class="text-danger fs-2 fw-bold">
                        @Model.Price.ToString("N0") ₫
                    </span>
                }
            </div>

            <!-- Màu sắc -->
            <div class="mt-3">
                <label class="form-label">Màu sắc:</label>
                <div class="d-flex flex-wrap gap-2">
                    @for (int i = 0; i < Model.ProductColors.Count; i++)
                    {
                        var color = Model.ProductColors[i];
                        var isSelected = i == 0;
                        <button type="button"
                                class="btn btn-sm mr-2 @(isSelected ? "text-white" : "btn-outline-secondary") color-option"
                                style="@(isSelected ? "background-color: #7fad39; " : "")"
                                data-color-id="@color.ColorId">
                            @color.Color.ColorName
                        </button>
                    }
                </div>
            </div>

            <!-- Số lượng -->
            <div class="mt-3">
                <label class="form-label">Số lượng:</label>
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-outline-secondary" type="button" onclick="changeQuantity(-1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" class="form-control text-center" id="quantityInput" min="1" value="1" style="width: 70px;" />
                    <button class="btn btn-outline-secondary" type="button" onclick="changeQuantity(1)">
                        <i class="fas fa-plus"></i>
                    </button>
                    <span class="ml-3">66 sản phẩm có sẵn</span>
                </div>
            </div>

            <!-- Nút hành động -->
            <div class="mt-4 d-flex gap-4">
                <button class="btn px-4 text-white" style="background-color: #7fad39;">Mua ngay</button>
                <button class="btn btn-outline-success px-4 custom-hover-green ml-4">
                    <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                </button>
            </div>
        </div>
    </div>


    <div class="row shadow-lg rounded-3 bg-white p-2 mt-2 ">
        <!-- BÊN TRÁI: Mô tả sản phẩm -->
        <div class="col-md-6">
            <div class="card border-0">
                <div class="card-body">
                    <h5 class="card-title">Mô tả sản phẩm</h5>
                    <p class="card-text">
                        @Html.Raw(Model.Description)  <!-- hoặc Model.Description nếu chỉ plain text -->
                    </p>
                </div>
            </div>
        </div>

        <!-- BÊN PHẢI: Chính sách -->
        <div class="col-md-6">
            <!-- Chính sách bảo hành -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-custom text-white">
                    Chính sách bảo hành
                </div>
                <div class="card-body">
                    <ul class="mb-0 pl-2">
                        <li>Bảo hành 12 tháng phần cứng tất cả lỗi của nhà sản xuất</li>
                        <li>Bảo hành miễn phí lỗi 1 đổi 1 trong 30 ngày</li>
                        <li>Phần mềm hỗ trợ trọn đời máy miễn phí</li>
                        <li>Vệ sinh, bảo dưỡng máy miễn phí mọi thời điểm</li>
                        <li>Cam kết máy zin nguyên bản, đảm bảo chất lượng của sản phẩm</li>
                    </ul>
                </div>
            </div>

            <!-- Chính sách sản phẩm -->
            <div class="card shadow-sm">
                <div class="card-header bg-custom text-white">
                    Chính sách sản phẩm
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="d-flex align-items-center mb-2">
                            <i class="fas fa-truck fa-lg me-2 text-custom  pr-2"></i>
                            Giao hàng toàn quốc
                        </li>
                        <li class="d-flex align-items-center mb-2">
                            <i class="fas fa-credit-card fa-lg me-2 text-custom pr-2 "></i>
                            Trả góp lãi suất 0% qua thẻ tín dụng Visa, Master, JCB
                        </li>
                        <li class="d-flex align-items-center">
                            <i class="fas fa-shopping-cart fa-lg me-2 text-custom pr-2"></i>
                            Miễn phí dùng thử trong 168 giờ
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- REVIEW SECTION (static UI) -->
    <div class="row shadow-lg rounded-3 bg-white p-2 mt-2">
        <!-- Tiêu đề và thanh lọc -->
        <div class="col-12">
            <h4 class="mb-3">Đánh giá sản phẩm</h4>
            <div class="d-flex align-items-center bg-light p-3 rounded mb-4">
                <!-- Điểm trung bình -->
                <span class="me-4 fs-3 fw-bold">4.8/5</span>
                <!-- Nav-pills để lọc -->
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Tất cả</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#">5 sao</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">4 sao</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">3 sao</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">2 sao</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">1 sao</a></li>
                </ul>
            </div>
        </div>

        <!-- Ví dụ 2 review tĩnh -->
        <div class="col-12">
            <!-- Review #1 -->
            <div class="d-flex mb-4">
                <img src="https://via.placeholder.com/50"
                     class="rounded-circle"
                     alt="avatar user"
                     style="object-fit:cover;" />
                <div class="ms-3 flex-grow-1">
                    <div class="d-flex align-items-center">
                        <h6 class="mb-0 me-2">Nguyễn Văn A</h6>
                        <div>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="far fa-star text-muted"></i>
                        </div>
                    </div>
                    <small class="text-muted">10:30 01/05/2025</small>
                    <p class="mt-2 mb-1">Sản phẩm rất tốt, giao hàng nhanh, đóng gói cẩn thận.</p>
                    <div class="d-flex flex-wrap gap-2">
                        <img src="https://via.placeholder.com/80"
                             class="img-thumbnail"
                             style="object-fit:cover;" alt="ảnh review" />
                        <img src="https://via.placeholder.com/80"
                             class="img-thumbnail"
                             style="object-fit:cover;" alt="ảnh review" />
                    </div>
                </div>
            </div>
            <hr />

            <!-- Review #2 -->
            <div class="d-flex mb-4">
                <img src="https://via.placeholder.com/50"
                     class="rounded-circle"
                     alt="avatar user"
                     style="object-fit:cover;" />
                <div class="ms-3 flex-grow-1">
                    <div class="d-flex align-items-center">
                        <h6 class="mb-0 me-2">Trần Thị B</h6>
                        <div>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star-half-alt text-warning"></i>
                            <i class="far fa-star text-muted"></i>
                        </div>
                    </div>
                    <small class="text-muted">14:45 28/04/2025</small>
                    <p class="mt-2 mb-1">Chất lượng ổn, đúng như mô tả, sẽ ủng hộ lần sau.</p>
                </div>
            </div>
            <hr />

            <!-- Bạn có thể copy thêm block trên để hiển thị nhiều review hơn -->
        </div>
    </div>



</div>

<script>
    function changeQuantity(delta) {
        const input = document.getElementById("quantityInput");
        let value = parseInt(input.value) || 1;
        value = Math.max(1, value + delta);
        input.value = value;
    }

    document.querySelectorAll(".color-option").forEach(btn => {
        btn.addEventListener("click", function () {
            document.querySelectorAll(".color-option").forEach(b => {
                b.classList.remove("text-white");
                b.classList.add("btn-outline-secondary");
                b.style.backgroundColor = "";
            });

            this.classList.remove("btn-outline-secondary");
            this.classList.add("text-white");
            this.style.backgroundColor = "#7fad39";

            // Thay đổi ảnh chính theo màu
            const colorId = this.getAttribute("data-color-id");
            const firstImage = document.querySelector(`#productColorImages .color-images[data-color-id="${colorId}"] img`);
            if (firstImage) {
                document.getElementById("mainImage").src = firstImage.src;
            }
        });
    });

    document.querySelectorAll("#productColorImages img").forEach(img => {
        img.addEventListener("click", function () {
            // Thay đổi ảnh chính khi click vào ảnh phụ
            document.getElementById("mainImage").src = this.src;
        });
    });
</script>
